海外三方地图分享地址到车

一、背景

当前XPENG app已经支持XPENG应用内发送地址到车，但暂不支持谷歌地图分享到XPENG发送到车，希望能够支持谷歌、苹果、WAZE等国外常用地图软件分享到XPENG app

二、竞品情况

参照文档海外地图分享地址到车

三、产品方案

需求车型：海外全车型

需求App版本：海外App 3.1.0及以上

需求XOS版本：海外XOS 5.2.0及以上

需求图商：苹果地图、谷歌地图、WAZE

方案整体可行，靠解析图商分享的URL获取经纬度发送到车

- 苹果地图无问题
- 谷歌地图：
- 实现方式：重定向 &gt; UTF-8编码的中间链接 &gt; 解码获取地址名称（如XX号XX街道XX市） &gt; 调用搜索api搜索地址获取经纬度 &gt; 发送到车。整体成功率自测197/200，测试结果见：海外分享地址到车验证

苹果地图：

https://maps.apple.com/?address=中国广东省云浮市云城区中南市&amp;auid=1117349751034010&amp;ll=22.731390,112.036200&amp;lsp=57879&amp;q=中南市&amp;t=m

WAZE：

使用Waze驾驶到广州东站：https://waze.com/ul/hws0edy286

https://www.waze.com/live-map/directions?to=ll.23.149631%2C113.324769

谷歌地图：

https://www.google.com/maps/place/98,+Waitrose+%26+Partners,+101+Marylebone+High+St+London+W1U+4SD%E8%8B%B1

%E5%9B%BD/data=!4m2!3m1!1s0x48761ad20f94f98b:0x5fd8ba5bb14ad6e9?utm\_source=mstt\_1&amp;entry=gps&amp;coh=192189&amp;g

ep=

CAESBz11LjEzLjYYACCenQoqdSw5NDI1OTU0OSW5NDIyMzI50SW5NDIxNjQxMyW5NDIxMjQ5Niw5NDIWNzM5NCW5NDIWNzUwNiw5NDIwODUWNiW5NDIxNzUyMyW5NDIxODY1MyW5NDIyOTgZOSWONZA4NDM5MyW5NDIxMzIWMCW5NDI1ODMyNUICQ04%3D&amp;skid=3607175e-acce-465d-86b6-45705b9924e2

测试：

多测试一些不同的POI点，如小语种、餐厅、景点、住址之类的

用户交互



[IMAGE_DESC]这张图片展示了一个流程图，描述了在某个应用中发送地址到车的流程。流程图从左到右依次进行，包含多个判断节点和操作步骤。以下是详细描述：

1. **起始节点**：流程从左上角的起始节点开始，显示了一个电脑桌面的截图，上面有多个应用程序图标。

2. **判断节点1**：询问“当前车辆的地区是否支持发送地址到车？”。
   - 如果“否”，则显示提示：“当前车辆暂不支持发送地址到车”。
   - 如果“是”，则进入下一个判断节点。

3. **判断节点2**：询问“网络不好？”。
   - 如果“是”，则显示提示：“网络不佳，请重试”。
   - 如果“否”，则进入下一个判断节点。

4. **判断节点3**：询问“当前应用是否支持？”。
   - 如果“否”，则显示提示：“当前应用暂不支持发送地址到车”。
   - 如果“是”，则进入下一个判断节点。

5. **判断节点4**：询问“发送成功？”。
   - 如果“是”，则流程结束，显示发送成功的界面截图，分别在iOS和安卓设备上。
   - 如果“否”，则显示发送失败的界面截图。

每个判断节点下方都有相应的提示信息，显示在手机屏幕上，提示用户当前操作的状态或需要采取的措施。整个流程图通过箭头连接各个节点，清晰地展示了发送地址到车的逻辑步骤和可能遇到的问题。[/IMAGE_DESC]



对上面这张图的描述：

图片类型

流程图

详细描述

主要组件和流程步骤

- 输入条件判断：
    - 判断“当前车辆的地区是否支持发送地址到车”。
        - 如果不支持，提示：“当前车辆暂不支持发送地址到车”。
    - 如果支持，继续下一步判断。
- 应用支持判断：
- 如果发送失败，提示：“发送失败，请重试”。

- 如果不支持，提示：“当前应用暂不支持发送地址到车”。

如果支持，继续下一步判断。

- 如果网络不佳，提示：“网络不佳，请重试”。

如果网络良好，继续下一步判断。

- 如果发送成功，流程结束。

数据流向和逻辑关系

- 流程从左到右依次进行，每个判断步骤根据条件分支到不同的提示或继续下一步操作。
- 每个判断步骤都有明确的输出提示，确保用户能够清楚了解当前状态。
- 流程的核心逻辑是依次检查车辆地区支持、应用支持、网络状态，最终判断是否能够成功发送地址到车。

文本内容

- 图片中包含以下文本提示：
- “当前应用暂不支持发送地址到车”
- “网络不佳，请重试”
- “发送失败，请重试”

总结

这张图片展示了一个用户交互流程，用于判断和提示用户在使用“发送地址到车”功能时可能遇到的各种情况。流程清晰地列出了每个判断条件及其对应的提示信息，确保用户在使用过程中能够获得明确的反馈。

发送逻辑



[IMAGE_DESC]这是一张流程图，分为前端、后端和车端三个部分。以下是详细描述：

### 前端部分：
1. **用户登录**：
   - 用户输入账号和密码进行登录。
   - 判断账号和密码是否正确。
     - 如果正确，进入下一步。
     - 如果不正确，提示“账号或密码错误”。

2. **用户身份验证**：
   - 判断用户是否为管理员。
     - 如果是管理员，进入下一步。
     - 如果不是管理员，提示“您不是管理员”。

3. **管理员权限验证**：
   - 判断管理员是否有权限访问特定功能。
     - 如果有权限，进入下一步。
     - 如果没有权限，提示“您没有权限访问此功能”。

4. **功能访问**：
   - 管理员可以访问特定功能，如“车辆管理”、“订单管理”等。

5. **操作完成**：
   - 完成操作后，提示“操作成功”。

### 后端部分：
1. **接收前端请求**：
   - 后端接收前端发送的请求。

2. **验证请求合法性**：
   - 判断请求是否合法。
     - 如果合法，进入下一步。
     - 如果不合法，返回错误信息。

3. **处理请求**：
   - 根据请求类型，调用相应的处理逻辑。

4. **返回结果**：
   - 将处理结果返回给前端。

### 车端部分：
1. **接收后端指令**：
   - 车端接收后端发送的指令。

2. **执行指令**：
   - 根据指令执行相应的操作。

3. **返回执行结果**：
   - 将执行结果返回给后端。

### 其他说明：
- 图中包含一些截图，展示了前端界面和后端界面的示例。
- 每个步骤都有相应的判断条件和操作流程，确保系统的安全性和稳定性。

这张流程图详细描述了用户从前端登录到后端处理请求，再到车端执行指令的整个流程，确保每个环节都有明确的操作步骤和判断条件。[/IMAGE_DESC]



对上面这张图的描述：

图片类型

流程图或架构图

详细描述

主要组件和流程步骤

前端：

    - 用户在前端（可能是手机应用或网页）进行操作，例如输入或选择地址。
    - 前端将用户操作的结果（如地址信息）通过某种方式（可能是API调用）传递给后端。

后端：

- 后端首先解析长链接，获取其中的经纬度信息。这可能是指从第三方地图服务（如谷歌地图、苹果地图等）获取的地址信息。
- 如果接收到的是短链接，后端会将其重定向到长链接，以便进一步解析。

车端：

- 车端接收这些信息后，可能会在车辆的导航系统中显示或进一步处理。

数据流向

- 前端到后端：用户在前端输入或选择地址后，前端将这些信息发送到后端。
- 后端处理：后端解析长链接，获取经纬度信息，并处理短链接的重定向。
- 后端到车端：后端将处理后的经纬度信息发送到车端。

逻辑关系

- 前端是用户交互的入口，负责收集用户输入的信息。
- 后端是处理核心，负责解析和处理地址信息。
- 车端是最终目标，接收处理后的信息并进行导航或其他操作。

文本内容

- 图片中的文本内容包括：
    - “前端”：表示用户操作的界面部分。
    - “取标出签家后，调用”：可能是指前端在用户完成某些操作后调用后端接口。
    - “后端”：表示服务器端处理部分。
    - “解析长链境；获取经”：表示后端解析长链接以获取经纬度信息。
    - “将短链接重定”：表示后端将短链接重定向到长链接。
    - “车端”：表示车辆端，接收处理后的信息。

总结

这张图片展示了一个系统架构或流程图，描述了从用户在前端输入地址信息，到后端解析和处理这些信息，最后将处理结果发送到车端的整个过程。图片清晰地展示了各个组件之间的数据流向和逻辑关系，确保了整个功能的顺利实现。

需求list

| 需求端   | 需求名称                   | 描述                                                                                                                                                                                                                                                                                                                                                                                                              | 图例   |
|----------|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------|
| 前端     | 分享至XPENG                | 谷歌地图、苹果地图、WAZE支持分享地址到XPENG应用                                                                                                                                                                                                                                                                                                                                                                   |        |
| 前端     | (仅iOS)分享至XPENG列表展示 | iOS系统，支持分享地址时，XPENG出现在分享的列表中  文案： Send to XPENG（需要翻译）                                                                                                                                                                                                                                                                                                                                |        |
| 前端     | (仅iOS)XPENG前置引导       | iOS系统，分享地址成功时，引导用户将XPENG添加到个人收藏，以尽可能靠前展示                                                                                                                                                                                                                                                                                                                                          |        |
| 前端     | 短链接重定向、解码、搜索   | 谷歌地图分享地址到XPENG后，XPENG app后台尝试重定向短链接为中间链接，并尝试解码获取地址名称，随后将名称调用谷歌api搜索，获取经纬度后发送到后端 具体实现方研发同学决定                                                                                                                                                                                                                                              |        |
| 前端     | 分享结果弹窗               | 分享失败/分享成功时，在第三方应用内以弹窗形式告知用户结果，无需再跳转到XPENG应用内  不支持发送： 正文：“当前车辆暂不支持发送地址到车”  分享成功： 标题：“发送成功” 正文：“已成功将地址{地址名称，如“First avenue”} 发送至您的{车型，如“XPENG G6”} 按钮：【确定】  分享失败： 标题：“发送失败” 正文：“暂无法获取当前地址，请尝试在XPENG应用内搜索地址” 按钮：【取消】【前往】 点击【前往】，跳转至发送地址到车页面 |        |
| 前端     | 登录态修复                 | 分享地址到小鹏app时，可能偶现分享失败的问题，原因是登录token过期。需要DIC修复                                                                                                                                                                                                                                                                                                                                     |        |
| 后端     | 经纬度解析                 | 苹果地图&WAZE地图：解析长链接以获取经纬度、名称，并将解析结果（成功/失败）返回给app，并在解析成功时发送经纬度至车端                                                                                                                                                                                                                                                                                               |        |

Todo：

- 发送成功给个设计稿
- 找hebe问一下谷歌api能否接后端
- 同步一下查询费用会增加

附录

（舍弃）备选：暂只做苹果地图

用户交互



[IMAGE_DESC]这是一张流程图，描述了在不同操作系统（iOS和安卓）上使用地图应用发送位置信息的流程。流程图的主要步骤如下：

1. **判断是否为苹果地图**：
   - 如果是苹果地图，流程继续到下一步。
   - 如果不是苹果地图，流程转向安卓系统的操作。

2. **发送成功？**：
   - 如果发送成功，流程结束。
   - 如果发送不成功，流程转向安卓系统的操作。

3. **iOS系统**：
   - 显示一个成功发送位置信息的界面截图。

4. **安卓系统**：
   - 显示一个发送失败的界面截图。

5. **安卓系统操作**：
   - 显示一个安卓设备上的地图应用界面，提示用户复制链接。
   - 显示一个文本编辑界面，用户可以粘贴并发送链接。

图中还包含一些界面截图，展示了不同操作系统上的具体操作界面，包括地图应用界面、发送成功或失败的提示界面，以及文本编辑界面。这些截图帮助用户理解在不同设备上操作的具体步骤和界面变化。[/IMAGE_DESC]



发送逻辑



[IMAGE_DESC]这是一张流程图，分为前端、后端和车端三个部分。以下是详细描述：

### 前端部分：
1. **获取/更新地图分享地址**：用户获取或更新地图分享地址。
2. **判断车辆的当前位置是否在分享范围内**：
   - 如果是，提示“车辆当前位置不在分享范围内”。
   - 如果否，提示“车辆当前位置在分享范围内”。
3. **是否需要提醒**：
   - 如果是，获取地图应用生成的分享链接。
   - 如果否，提示“暂无车辆位置提醒，继续查看车辆位置与分享链接”。

### 后端部分：
1. **根据提醒设置，判断是否需要发送提醒**：
   - 如果是，解析出提醒，获取链接或24小时名称。
   - 如果否，提示“已根据提醒设置，暂时不发送提醒”。

### 车端部分：
1. **大屏幕和后视镜提醒**：在车端的大屏幕和后视镜上显示提醒信息。

整个流程图展示了从前端获取和更新地图分享地址，到后端判断是否需要发送提醒，再到车端显示提醒信息的完整流程。每个步骤都有相应的判断和提示，确保用户能够及时获取车辆位置信息和提醒。[/IMAGE_DESC]



| 需求端   | 需求名称                   | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 图例   |
|----------|----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------|
| 前端     | 分享至XPENG                | 苹果地图支持分享地址到XPENG应用                                                                                                                                                                                                                                                                                                                                                                                                                                              |        |
| 前端     | (仅iOS)分享至XPENG列表展示 | iOS系统，支持分享地址时，XPENG出现在分享的列表中  文案： Send to XPENG（需要翻译）                                                                                                                                                                                                                                                                                                                                                                                           |        |
| 前端     | (仅iOS)XPENG前置引导       | iOS系统，分享地址成功时，引导用户将XPENG添加到个人收藏，以尽可能靠前展示                                                                                                                                                                                                                                                                                                                                                                                                     |        |
| 前端     | 分享结果弹窗               | 分享失败/分享成功时，在第三方应用内以弹窗形式告知用户结果，无需再跳转到XPENG应用内  地区不支持发送： 正文：“当前车辆暂不支持发送地址到车”  应用不支持发送： 正文：“当前应用暂不支持发送地址到车”  分享成功： 标题：“发送成功” 正文：“已成功将地址{地址名称，如“First avenue”} 发送至您的{车型，如“XPENG G6”} 按钮：【确定】  分享失败： 标题：“发送失败” 正文：“暂无法获取当前地址，请尝试在XPENG应用内搜索地址” 按钮：【取消】【前往】 点击【前往】，跳转至发送地址到车页面 |        |
| 前端     | 登录态修复                 | 分享地址到小鹏app时，可能偶现分享失败的问题，原因是登录token过期。DIC同学已经修复了此问题，需要合并打包。                                                                                                                                                                                                                                                                                                                                                                    |        |
| 后端     | 经纬度解析                 | 解析长链接以获取经纬度、名称，并将解析结果（成功/失败）返回给app，并在解析成功时发送经纬度至车端                                                                                                                                                                                                                                                                                                                                                                             |        |