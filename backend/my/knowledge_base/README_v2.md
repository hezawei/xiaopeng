# ä¸šåŠ¡çŸ¥è¯†åº“ç®¡ç†ç³»ç»Ÿ - é‡æ„ç‰ˆæœ¬ v2.0

## æ¦‚è¿°

è¿™æ˜¯ä¸šåŠ¡çŸ¥è¯†åº“ç®¡ç†ç³»ç»Ÿçš„é‡æ„ç‰ˆæœ¬ï¼Œé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå¤§å¹…æå‡äº†ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œå¥å£®ç¨³å®šæ€§ã€‚åŸå§‹çš„ `business_knowledge_base.py` æ–‡ä»¶å·²ä¿ç•™ä½œä¸ºå¤‡ä»½ã€‚

## é‡æ„äº®ç‚¹

### ğŸ¯ æ ¸å¿ƒæ”¹è¿›

1. **æ¨¡å—åŒ–æ¶æ„**ï¼šå°†åŸæ¥çš„å•ä¸€å¤§æ–‡ä»¶æ‹†åˆ†ä¸º9ä¸ªä¸“é—¨çš„æ¨¡å—
2. **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šæ··åˆæœç´¢å’Œå…³è”å…³ç³»æ„å»ºè¢«ç‹¬ç«‹æ‹†åˆ†
3. **ä¾èµ–æ³¨å…¥**ï¼šé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–ï¼Œæé«˜å¯æµ‹è¯•æ€§
4. **æ¥å£éš”ç¦»**ï¼šæ¯ä¸ªæ¨¡å—æä¾›æ¸…æ™°çš„æ¥å£å®šä¹‰
5. **é”™è¯¯å¤„ç†**ï¼šå¢å¼ºçš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•

### ğŸ”§ æŠ€æœ¯ä¿æŒ

- âœ… **Milvuså‘é‡æ•°æ®åº“**ï¼šå®Œå…¨ä¿ç•™åŸæœ‰çš„Milvusé›†æˆ
- âœ… **æœ¬åœ°å‘é‡åŒ–å¤„ç†**ï¼šç»§ç»­ä½¿ç”¨HuggingFaceåµŒå…¥æ¨¡å‹
- âœ… **å¤šæ¨¡æ€å¤„ç†**ï¼šä¿ç•™å›¾ç‰‡å¤„ç†å’Œæ–‡æ¡£è½¬æ¢åŠŸèƒ½
- âœ… **æ‰€æœ‰åŸæœ‰åŠŸèƒ½**ï¼šæ— åŠŸèƒ½ç¼ºå¤±ï¼Œå®Œå…¨å‘åå…¼å®¹

## æ¨¡å—æ¶æ„

```
knowledge_base/
â”œâ”€â”€ business_knowledge_base_manager.py  # ğŸ¯ æ ¸å¿ƒç®¡ç†å™¨
â”œâ”€â”€ metadata_manager.py                 # ğŸ“Š å…ƒæ•°æ®ç®¡ç†
â”œâ”€â”€ index_manager.py                    # ğŸ” ç´¢å¼•ç®¡ç†
â”œâ”€â”€ document_processor_v2.py            # ğŸ“„ æ–‡æ¡£å¤„ç†
â”œâ”€â”€ relation_manager_v2.py              # ğŸ”— å…³è”å…³ç³»ç®¡ç†
â”œâ”€â”€ entity_extractor.py                 # ğŸ·ï¸ å®ä½“æå–
â”œâ”€â”€ hybrid_search_engine.py             # ğŸ”€ æ··åˆæœç´¢å¼•æ“
â”œâ”€â”€ query_engine.py                     # â“ æŸ¥è¯¢å¼•æ“
â”œâ”€â”€ sync_manager.py                     # ğŸ”„ åŒæ­¥ç®¡ç†
â”œâ”€â”€ utils_v2.py                         # ğŸ› ï¸ å·¥å…·å‡½æ•°
â”œâ”€â”€ example_usage.py                    # ğŸ“– ä½¿ç”¨ç¤ºä¾‹
â””â”€â”€ README_v2.md                        # ğŸ“š è¯´æ˜æ–‡æ¡£
```

## æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 1. BusinessKnowledgeBaseManager
**æ ¸å¿ƒç®¡ç†å™¨**ï¼Œæä¾›ç»Ÿä¸€çš„å¯¹å¤–æ¥å£ï¼Œåè°ƒå„ä¸ªå­æ¨¡å—çš„å·¥ä½œã€‚

```python
manager = BusinessKnowledgeBaseManager(
    embedding_model_name="BAAI/bge-small-zh-v1.5",
    milvus_uri="tcp://localhost:19530"
)
```

### 2. RelationManager + EntityExtractor + HybridSearchEngine
**æ··åˆæœç´¢æ ¸å¿ƒç»„ä»¶**ï¼ˆé‡ç‚¹æ‹†åˆ†ï¼‰ï¼Œè´Ÿè´£ï¼š
- ä»æ–‡æ¡£ä¸­æå–å®ä½“
- æ„å»ºä¸šåŠ¡é—´çš„å…³è”å…³ç³»
- å®ç°è·¨ä¸šåŠ¡çš„æ··åˆæœç´¢

### 3. IndexManager
**ç´¢å¼•ç®¡ç†å™¨**ï¼Œå°è£…æ‰€æœ‰Milvusç›¸å…³æ“ä½œï¼š
- é›†åˆçš„åˆ›å»ºã€åˆ é™¤ã€ç®¡ç†
- å‘é‡ç´¢å¼•çš„æ„å»ºå’ŒæŸ¥è¯¢
- ç´¢å¼•é…ç½®çš„æŒä¹…åŒ–

### 4. MetadataManager
**å…ƒæ•°æ®ç®¡ç†å™¨**ï¼Œè´Ÿè´£ä¸šåŠ¡å’Œæ–‡æ¡£ä¿¡æ¯çš„å­˜å‚¨ï¼š
- ä¸šåŠ¡çŸ¥è¯†åº“çš„åˆ›å»ºå’Œç®¡ç†
- æ–‡æ¡£ä¿¡æ¯çš„å­˜å‚¨å’Œæ£€ç´¢
- æ•°æ®ä¸€è‡´æ€§ä¿éšœ

### 5. DocumentProcessor
**æ–‡æ¡£å¤„ç†å™¨**ï¼Œé›†æˆç°æœ‰çš„æ–‡æ¡£å¤„ç†å·¥å‚ï¼š
- è‡ªåŠ¨æ£€æµ‹æ–‡æ¡£æ˜¯å¦åŒ…å«å›¾ç‰‡
- æ™ºèƒ½é€‰æ‹©å¤„ç†æ–¹å¼ï¼ˆå›¾ç‰‡å¤„ç†å™¨ vs ç›´æ¥å¤„ç†ï¼‰
- æ”¯æŒPDFã€DOCXã€TXTç­‰æ ¼å¼
- é›†æˆå¤šæ¨¡æ€å›¾ç‰‡å¤„ç†

## å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨

```python
import asyncio
from knowledge_base import BusinessKnowledgeBaseManager

async def main():
    # åˆ›å»ºç®¡ç†å™¨
    manager = BusinessKnowledgeBaseManager()
    
    # åˆ›å»ºä¸šåŠ¡çŸ¥è¯†åº“
    manager.create_business_kb("intelligent_chassis", "æ™ºèƒ½åº•ç›˜")
    
    # æ·»åŠ æ–‡æ¡£
    doc_ids = await manager.add_documents_to_kb(
        "intelligent_chassis", 
        ["doc1.pdf", "doc2.docx"]
    )
    
    # æŸ¥è¯¢
    result = await manager.query_business_kb(
        "intelligent_chassis", 
        "æ™ºèƒ½åº•ç›˜çš„æ ¸å¿ƒåŠŸèƒ½"
    )
    print(result["response"])

asyncio.run(main())
```

### 2. è·¨ä¸šåŠ¡æ··åˆæœç´¢

```python
# è·¨ä¸šåŠ¡æŸ¥è¯¢ï¼ˆé‡ç‚¹åŠŸèƒ½ï¼‰
result = await manager.query_with_cross_business(
    primary_business_id="intelligent_chassis",
    query="ä¼ æ„Ÿå™¨æŠ€æœ¯åº”ç”¨",
    expand_to_related=True,
    max_related_businesses=2
)
```

### 3. æ•°æ®åŒæ­¥

```python
# åŒæ­¥æ‰€æœ‰ä¸šåŠ¡
sync_result = await manager.sync_all_businesses()
print(f"åŒæ­¥äº† {sync_result['synced_businesses']} ä¸ªä¸šåŠ¡")
```

## é…ç½®è¯´æ˜

### é»˜è®¤é…ç½®

```python
DEFAULT_CONFIG = {
    "embedding_model_name": "BAAI/bge-small-zh-v1.5",
    "milvus_uri": "tcp://localhost:19530",
    "chunk_size": 512,
    "chunk_overlap": 50,
    "max_entities": 15,
    "similarity_top_k": 3,
    "max_related_businesses": 2
}
```

### è‡ªå®šä¹‰é…ç½®

```python
manager = BusinessKnowledgeBaseManager(
    embedding_model_name="your-model-name",
    milvus_uri="your-milvus-uri",
    base_dir="/custom/path"
)
```

## ä¾èµ–è¦æ±‚

### å¿…éœ€ä¾èµ–
- `llama-index` - æ–‡æ¡£å¤„ç†å’Œç´¢å¼•
- `pymilvus` - Milvuså‘é‡æ•°æ®åº“
- `docling` - æ–‡æ¡£è½¬æ¢
- `scikit-learn` - æœºå™¨å­¦ä¹ å·¥å…·
- `pathlib` - è·¯å¾„å¤„ç†

### å¯é€‰ä¾èµ–
- `psutil` - ç³»ç»Ÿä¿¡æ¯
- `spacy` - è‡ªç„¶è¯­è¨€å¤„ç†
- `jieba` - ä¸­æ–‡åˆ†è¯

## é‡æ„å¯¹æ¯”

| æ–¹é¢ | åŸç‰ˆæœ¬ | é‡æ„ç‰ˆæœ¬ |
|------|--------|----------|
| æ–‡ä»¶æ•°é‡ | 1ä¸ªå¤§æ–‡ä»¶ | 9ä¸ªä¸“é—¨æ¨¡å— |
| ä»£ç è¡Œæ•° | 1800+ è¡Œ | æ¯ä¸ªæ¨¡å— < 300 è¡Œ |
| å¯è¯»æ€§ | ğŸ˜ ä¸€èˆ¬ | ğŸ˜Š ä¼˜ç§€ |
| å¯ç»´æŠ¤æ€§ | ğŸ˜ å›°éš¾ | ğŸ˜Š å®¹æ˜“ |
| å¯æ‰©å±•æ€§ | ğŸ˜ å—é™ | ğŸ˜Š çµæ´» |
| æµ‹è¯•å‹å¥½ | ğŸ˜ å›°éš¾ | ğŸ˜Š å®¹æ˜“ |
| æ··åˆæœç´¢ | ğŸ˜ è€¦åˆ | ğŸ˜Š ç‹¬ç«‹ |

## è¿è¡Œç¤ºä¾‹

```bash
# è¿è¡Œä½¿ç”¨ç¤ºä¾‹
cd backend/my/knowledge_base
python example_usage.py
```

## æ³¨æ„äº‹é¡¹

1. **åŸæ–‡ä»¶ä¿ç•™**ï¼š`business_knowledge_base.py` å·²ä¿ç•™ä½œä¸ºå¤‡ä»½
2. **åŠŸèƒ½å®Œæ•´**ï¼šæ‰€æœ‰åŸæœ‰åŠŸèƒ½éƒ½å·²ä¿ç•™ï¼Œæ— åŠŸèƒ½ç¼ºå¤±
3. **å‘åå…¼å®¹**ï¼šAPIæ¥å£ä¿æŒå…¼å®¹
4. **Milvusä¾èµ–**ï¼šç¡®ä¿MilvusæœåŠ¡æ­£å¸¸è¿è¡Œ
5. **æ–‡æ¡£è·¯å¾„**ï¼šç¤ºä¾‹ä¸­çš„æ–‡æ¡£è·¯å¾„éœ€è¦æ›¿æ¢ä¸ºå®é™…è·¯å¾„

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„å®ä½“æå–æ–¹æ³•

```python
# åœ¨ entity_extractor.py ä¸­æ·»åŠ æ–°æ–¹æ³•
def _extract_by_custom_method(self, text: str, max_entities: int) -> List[str]:
    # å®ç°è‡ªå®šä¹‰å®ä½“æå–é€»è¾‘
    pass
```

### æ·»åŠ æ–°çš„æŸ¥è¯¢æ¨¡å¼

```python
# åœ¨ query_engine.py ä¸­æ·»åŠ æ–°çš„å“åº”æ¨¡å¼
def _build_custom_response(self, query: str, results: List[Dict]) -> Dict[str, Any]:
    # å®ç°è‡ªå®šä¹‰å“åº”æ ¼å¼
    pass
```

### é›†æˆæ–°çš„å‘é‡æ•°æ®åº“

```python
# åˆ›å»ºæ–°çš„ç´¢å¼•ç®¡ç†å™¨
class CustomIndexManager(IndexManager):
    # å®ç°è‡ªå®šä¹‰å‘é‡æ•°æ®åº“é›†æˆ
    pass
```

## è´¡çŒ®æŒ‡å—

1. éµå¾ªå•ä¸€èŒè´£åŸåˆ™
2. ä¿æŒæ¥å£ç®€æ´æ¸…æ™°
3. æ·»åŠ å……åˆ†çš„é”™è¯¯å¤„ç†
4. ç¼–å†™è¯¦ç»†çš„æ–‡æ¡£æ³¨é‡Š
5. æä¾›ä½¿ç”¨ç¤ºä¾‹

## ç‰ˆæœ¬å†å²

- **v2.0.0** - é‡æ„ç‰ˆæœ¬å‘å¸ƒ
  - æ¨¡å—åŒ–æ¶æ„è®¾è®¡
  - æ··åˆæœç´¢åŠŸèƒ½ç‹¬ç«‹æ‹†åˆ†
  - å®Œæ•´ä¿ç•™åŸæœ‰åŠŸèƒ½
  - å¤§å¹…æå‡ä»£ç è´¨é‡

---

**é‡æ„å®Œæˆ** âœ… 

åŸå§‹åŠŸèƒ½å®Œå…¨ä¿ç•™ï¼Œä»£ç ç»“æ„å¤§å¹…ä¼˜åŒ–ï¼Œç‰¹åˆ«æ˜¯æ··åˆæœç´¢å’Œå…³è”å…³ç³»æ„å»ºéƒ¨åˆ†å·²ç‹¬ç«‹æ‹†åˆ†ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚
